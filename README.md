# ConnectX DQN Agent

æ·±åº¦ Q ç½‘ç»œ (DQN) æ™ºèƒ½ä½“ï¼Œç”¨äº Kaggle ConnectX ç«èµ›ã€‚

## é¡¹ç›®ç»“æ„

```
connectX/
â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ config.py          # é…ç½®å‚æ•°
â”‚   â”œâ”€â”€ dqn_model.py       # DQN ç¥ç»ç½‘ç»œæ¨¡å‹
â”‚   â”œâ”€â”€ dqn_agent.py       # DQN æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ replay_buffer.py   # ç»éªŒå›æ”¾ç¼“å†²åŒº
â”‚   â””â”€â”€ utils.py           # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ training/              # è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ train_dqn.py       # ä¸»è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ test_setup.py      # è®­ç»ƒç¯å¢ƒæµ‹è¯•
â”‚   â””â”€â”€ visualize.py       # è®­ç»ƒç»“æœå¯è§†åŒ–
â”‚
â”œâ”€â”€ submission/            # Kaggle æäº¤æ–‡ä»¶
â”‚   â”œâ”€â”€ main.py            # åµŒå…¥æ¨¡å‹çš„æäº¤æ–‡ä»¶ (9.6 MB)
â”‚   â”œâ”€â”€ main_backup.py     # åŸå§‹ç‰ˆæœ¬ï¼ˆéœ€è¦ .pth æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ best_model.pth     # è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
â”‚   â””â”€â”€ prepare_submission.py  # å‡†å¤‡æäº¤åŒ…
â”‚
â”œâ”€â”€ tools/                 # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ embed_model.py     # æ¨¡å‹è½¬ Base64
â”‚   â”œâ”€â”€ create_embedded_main.py  # ç”ŸæˆåµŒå…¥ç‰ˆæœ¬
â”‚   â”œâ”€â”€ run_embed.bat      # Windows ä¸€é”®è„šæœ¬
â”‚   â””â”€â”€ run_embed.sh       # Linux/Mac ä¸€é”®è„šæœ¬
â”‚
â”œâ”€â”€ archive/               # è®­ç»ƒå†å²å­˜æ¡£
â”‚   â”œâ”€â”€ checkpoints/       # å†å²æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ logs/              # è®­ç»ƒæ—¥å¿—
â”‚   â””â”€â”€ plots/             # è®­ç»ƒå›¾è¡¨
â”‚
â””â”€â”€ requirements.txt       # Python ä¾èµ–
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
cd training
python train_dqn.py
```

### 3. ç”Ÿæˆæäº¤æ–‡ä»¶

ä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼ A: ä½¿ç”¨åµŒå…¥æ¨¡å‹ï¼ˆæ¨èï¼‰**

```bash
cd tools
# Windows
run_embed.bat

# Linux/Mac
chmod +x run_embed.sh
./run_embed.sh
```

ç”Ÿæˆçš„ `submission/main.py` åŒ…å«å®Œæ•´æ¨¡å‹ï¼Œå¯ç›´æ¥æäº¤ã€‚

~~**æ–¹å¼ B: ä½¿ç”¨å¤–éƒ¨æ¨¡å‹æ–‡ä»¶**~~

```bash
cd submission
python prepare_submission.py
```

ç”Ÿæˆçš„ `submission.zip` åŒ…å« `main_backup.py` å’Œ `best_model.pth`ã€‚

### 4. æäº¤åˆ° Kaggle

**æ–¹å¼ Aï¼ˆåµŒå…¥æ¨¡å‹ï¼‰ï¼š**
ä¸Šä¼  `submission/main.py`

~~**æ–¹å¼ Bï¼ˆæ‰“åŒ…æäº¤ï¼‰ï¼š**~~
ä¸Šä¼  `submission/submission.zip`

## æŠ€æœ¯ç‰¹ç‚¹

### DQN æ¨¡å‹æ¶æ„

- 3 å±‚ CNN (64, 128, 128 é€šé“)
- Batch Normalization
- Dropout (0.3)
- å…¨è¿æ¥å±‚ (256 â†’ 128 â†’ 7)

### æ··åˆç­–ç•¥ï¼ˆå¢å¼ºç‰ˆï¼‰

1. ä¼˜å…ˆå–èƒœ
2. é˜»æ­¢å¯¹æ‰‹è·èƒœ
3. **é˜»æ­¢å¯¹æ‰‹å‰æ”»** (åŒé‡å¨èƒ) ğŸ†•
4. é˜»æ­¢å¯¹æ‰‹å¨èƒ (3 è¿)
5. **å®‰å…¨ç§»åŠ¨è¿‡æ»¤** ğŸ†•
6. DQN Q å€¼å†³ç­–
7. ä¸­å¿ƒä¼˜å…ˆå›é€€

### çŠ¶æ€ç¼–ç 

- 3 é€šé“è¾“å…¥ (6x7):
  - ç©å®¶æ£‹å­ä½ç½®
  - å¯¹æ‰‹æ£‹å­ä½ç½®
  - æœ‰æ•ˆç§»åŠ¨æ©ç 

## è®­ç»ƒé…ç½®

è¯¦è§ `core/config.py`:

- Episodes: 5000
- Batch size: 64
- Learning rate: 0.0001
- Gamma: 0.99
- Epsilon decay: 0.995

## ç¯å¢ƒè¦æ±‚

- Python 3.7+
- PyTorch 1.10+
- NumPy
- Kaggle Environments

å®Œæ•´åˆ—è¡¨è§ `requirements.txt`

## æ¨¡å‹åµŒå…¥è¯´æ˜

`main.py` åŒ…å« Base64 ç¼–ç çš„æ¨¡å‹æƒé‡ (~9.6 MB)ï¼Œæ— éœ€å¤–éƒ¨æ–‡ä»¶ã€‚
å¦‚éœ€é‡æ–°ç”Ÿæˆï¼Œä½¿ç”¨ `tools/` ä¸‹çš„è„šæœ¬ã€‚

## æœ€æ–°å¢å¼ºåŠŸèƒ½ (v1.1)

### æ–°å¢å®‰å…¨æ£€æŸ¥æœºåˆ¶

1. **å‰æ”»æ£€æµ‹** (`find_two_threat_blocking_move`)

   - æ£€æµ‹å¹¶é˜»æ­¢å¯¹æ‰‹åˆ›å»ºåŒé‡è·èƒœå¨èƒ
   - é˜²æ­¢æ— æ³•é˜²å®ˆçš„å±€é¢

2. **å®‰å…¨ç§»åŠ¨è¿‡æ»¤** (`find_safe_moves`)

   - è¯†åˆ«ä¸ä¼šè®©å¯¹æ‰‹ç«‹å³è·èƒœçš„ç§»åŠ¨
   - ä¼˜å…ˆé€‰æ‹©å®‰å…¨çš„å†³ç­–

3. **å³æ—¶è·èƒœè®¡æ•°** (`count_immediate_wins`)
   - å¿«é€Ÿè¯„ä¼°æ£‹ç›˜ä¸Šçš„è·èƒœæœºä¼š
   - ç”¨äºå¨èƒè¯„ä¼°å’Œç­–ç•¥è§„åˆ’

### æµ‹è¯•å’Œè¯Šæ–­

```bash
# è¿è¡Œè¯Šæ–­å·¥å…·ï¼ˆæ¨èé¦–æ¬¡è¿è¡Œï¼‰
python diagnose.py

# æµ‹è¯•æ–°åŠŸèƒ½
python test_enhancements.py

# éªŒè¯æ¨¡å—ä¸€è‡´æ€§
python test_consistency.py
```

### æ€§èƒ½æŒ‡æ ‡

- å¹³å‡å†³ç­–æ—¶é—´: ~8ms
- æ–°å¢æ£€æŸ¥å¼€é”€: ~2-5ms
- Kaggle å…¼å®¹: âœ… å®Œå…¨å…¼å®¹

è¯¦è§ `ENHANCEMENTS_GUIDE.md` è·å–å®Œæ•´æ–‡æ¡£ã€‚

## é—®é¢˜æ’æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **è¿è¡Œè¯Šæ–­å·¥å…·**

   ```bash
   python diagnose.py
   ```

2. **æ£€æŸ¥å¸¸è§é—®é¢˜**

   - å¯¼å…¥é”™è¯¯: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è·¯å¾„
   - å‡½æ•°ç¼ºå¤±: è¿è¡Œè¯Šæ–­å·¥å…·æ£€æŸ¥
   - æ€§èƒ½é—®é¢˜: è¿è¡Œ `python test_enhancements.py`

3. **æŸ¥çœ‹æ–‡æ¡£**
   - å¢å¼ºåŠŸèƒ½: `ENHANCEMENTS_GUIDE.md`
   - é¡¹ç›®ç»“æ„: `.project_structure.txt`

## è®¸å¯è¯

MIT License
